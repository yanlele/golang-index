## 结构体

Go 语言通过用自定义的方式形成新的类型，结构体是类型中带有成员的复合类型。
Go 语言使用结构体和结构体成员来描述真实世界的实体和实体对应的各种属性。

Go 语言中的类型可以被实例化，使用 `new` 或 `&` 构造的类型实例的类型是类型的指针。



### 结构体的定义
结构体成员也可以称为“字段”，这些字段有以下特性：                       
- 字段拥有自己的类型和值；
- 字段名必须唯一；
- 字段的类型也可以是结构体，甚至是字段所在结构体的类型。


结构体的定义格式如下：
```go
type 类型名 struct {
    字段1 字段1类型
    字段2 字段2类型
    …
}
```

同类型的变量也可以写在一行, 例如：                      
```go
type Color struct {
    R, G, B byte
}
```

### 例化结构体——为结构体分配内存并初始化
结构体的定义只是一种内存布局的描述，只有当结构体实例化时，才会真正地分配内存，
因此必须在定义结构体并实例化后才能使用结构体的字段。


#### 基本的实例化形式
基本实例化格式如下：`var ins T`                           

用结构体表示的点结构（Point）的实例化过程请参见下面的代码：                        
```go
type Point struct {
    X int
    Y int
}
var p Point
p.X = 10
p.Y = 20
```

#### 创建指针类型的结构体
Go语言中，还可以使用 new 关键字对类型（包括结构体、整型、浮点数、字符串等）进行实例化，结构体在实例化后会形成指针类型的结构体。

使用 new 的格式如下：`ins := new(T)`

举例子：                    
```go
type Player struct{
    Name string
    HealthPoint int
    MagicPoint int
}
tank := new(Player)
tank.Name = "Canon"
tank.HealthPoint = 300
```

#### 取结构体的地址实例化
对结构体进行&取地址操作时，视为对该类型进行一次 new 的实例化操作，取地址格式如下：`ins := &T{}`

举例子：                
```go
type Command struct {
    Name    string    // 指令名称
    Var     *int      // 指令绑定的变量
    Comment string    // 指令的注释
}
var version int = 1
cmd := &Command{}
cmd.Name = "version"
cmd.Var = &version
cmd.Comment = "show version"
```

**取地址实例化是最广泛的一种结构体实例化方式，可以使用函数封装上面的初始化过程**
```go
package main

type Command struct {
	Name    string
	Var     *int
	Comment string
}

func newCommand(name string, varref *int, comment string) *Command {
	return &Command{
		Name:    name,
		Var:     varref,
		Comment: comment,
	}
}

func main() {
	version := 12
	cmd := newCommand("version", &version, "show  version")

	cmd2 := &Command{
		Name:    "version",
		Var:     &version,
		Comment: "show version",
	}
}
```


### 初始化结构体的成员变量
结构体在实例化时可以直接对成员变量进行初始化，初始化有两种形式分别是以字段 **“键值对”形式** 和 **多个值的列表形式**

#### 使用“键值对”初始化结构体
键值对初始化的格式如下：                    
```go
ins := 结构体类型名{
    字段1: 字段1的值,
    字段2: 字段2的值,
    …
}
```

使用键值对填充结构体的例子:              
````go
package main

import "fmt"

type People struct {
	name  string
	child *People
}

func main() {
	relation := &People{
		name: "爷爷",
		child: &People{
			name: "爸爸",
			child: &People{
				name: "我",
			},
		},
	}
	
	fmt.Println(relation)
}
````


#### 使用多个值的列表初始化结构体
Go语言可以在“键值对”初始化的基础上忽略“键”，也就是说，可以使用多个值的列表初始化结构体的字段。

多个值列表初始化结构体的书写格式:                   
```go
ins := 结构体类型名{
    字段1的值,
    字段2的值,
    …
}
```

需要注意：                   
- 必须初始化结构体的所有字段。
- 每一个初始值的填充顺序必须与字段在结构体中的声明顺序一致。
- 键值对与值列表的初始化形式不能混用。

多个值列表初始化结构体的例子：                     
```go
type Address struct {
    Province    string
    City        string
    ZipCode     int
    PhoneNumber string
}
addr := Address{
    "四川",
    "成都",
    610000,
    "0",
}
fmt.Println(addr)
```


#### 初始化匿名结构体
**匿名结构体定义格式和初始化写法**                     
```go
ins := struct {
    // 匿名结构体字段定义
    字段1 字段类型1
    字段2 字段类型2
    …
}{
    // 字段值初始化
    初始化字段1: 字段1的值,
    初始化字段2: 字段2的值,
    …
}
```

使用匿名结构体的例子：                 
```go
package main
import (
    "fmt"
)
// 打印消息类型, 传入匿名结构体
func printMsgType(msg *struct {
    id   int
    data string
}) {
    // 使用动词%T打印msg的类型
    fmt.Printf("%T\n", msg)
}
func main() {
    // 实例化一个匿名结构体
    msg := &struct {  // 定义部分
        id   int
        data string
    }{  // 值初始化部分
        1024,
        "hello",
    }
    printMsgType(msg)
}
```


